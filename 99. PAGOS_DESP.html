<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Generador HAScript Pagos</title>
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    padding: 20px;
}

.container {
    max-width: 900px;
    margin: 0 auto;
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

h2 {
    color: #333;
    margin-top: 0;
}

h3 {
    color: #555;
    margin-top: 20px;
}

.preview-label {
    font-weight: bold;
    color: #555;
    margin-bottom: 8px;
}

textarea {
    width: 100%;
    height: 120px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-family: monospace;
    font-size: 13px;
    box-sizing: border-box;
    margin-bottom: 15px;
    resize: vertical;
}

#resultado {
    height: 300px;
    background-color: #f9f9f9;
}

.button-row {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

button {
    padding: 10px 20px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
}

button:hover {
    background-color: #45a049;
}

button:active {
    background-color: #3d8b40;
}

.checkbox-container {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    padding: 10px;
    background-color: #f0f8ff;
    border-left: 4px solid #2196F3;
    border-radius: 4px;
}

.checkbox-container input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.checkbox-container label {
    cursor: pointer;
    font-weight: 500;
    color: #333;
    margin: 0;
}
</style>
</head>
<body>
<div class="container">
    <h2>Generador de HAScript Pagos</h2>

    <p class="preview-label">Pega el listado (formato: Carro TAB Tipo 6/7/8):</p>
    <textarea id="listado" placeholder="220324	7&#10;240092	6"></textarea>

    <div class="checkbox-container">
        <input type="checkbox" id="dobleOperador" name="dobleOperador">
        <label for="dobleOperador">¿Doble Operador?</label>
    </div>

    <div class="button-row">
        <button onclick="generarHAScript()">Generar</button>
        <button onclick="copiarResultado()">Copiar</button>
        <button onclick="limpiarCampos()">Limpiar</button>
    </div>

    <h3>Resultado:</h3>
    <textarea id="resultado" readonly></textarea>
</div>

<script>
function generarHAScript() {
    const texto = document.getElementById('listado').value.trim();
    const resultado = document.getElementById('resultado');
    const dobleOperador = document.getElementById('dobleOperador').checked;
    
    if (!texto) { alert("Por favor ingresa el listado."); return; }

    const lineas = texto.split('\n');
    const pares = [];

    for (const linea of lineas) {
        const match = linea.match(/^(\d+)\s+(\d+)$/);
        if (match) { pares.push({ numeroCarro: match[1], tipo: match[2] }); }
    }

    if (pares.length === 0) { resultado.value = "No se encontraron pares válidos."; return; }

    let macro = `<HAScript name="despacho" description="Flujo completo" timeout="20000" pausetime="300" promptall="true" blockinput="true" author="burra" creationdate="Oct 02, 2025 12:00:00 PM" supressclearevents="false" usevars="false" ignorepauseforenhancedtn="true" delayifnotenhancedtn="0" ignorepausetimeforenhancedtn="true" continueontimeout="false">\n`;

    pares.forEach((par, index) => {
        let val11 = "", val12 = "";
        if (par.tipo === "6") { val11 = "3150"; val12 = "1800"; }
        if (par.tipo === "7") { val11 = "3675"; val12 = "2100"; }
        if (par.tipo === "8") { val11 = "4200"; val12 = "2400"; }

        const siguienteBloque = index < pares.length - 1 ? `Carro_${pares[index+1].numeroCarro}_${pares[index+1].tipo}` : "";

        macro += `
<!-- Bloque ${index+1} -->
<screen name="Carro_${par.numeroCarro}_${par.tipo}" entryscreen="${index===0?'true':'false'}" exitscreen="false" transient="false">
    <description><oia status="NOTINHIBITED" optional="false" invertmatch="false" /></description>
    <actions>
        ${index===0?'':'<input value="[pf3]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />'}
        <input value="${par.numeroCarro}" row="1" col="8" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[enter]" row="1" col="8" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="NOGASO" row="1" col="42" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="X" row="1" col="68" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[enter]" row="1" col="68" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[enter]" row="1" col="68" movecursor="true" xlatehostkeys="true" encrypted="false" />
    </actions>
    <nextscreens timeout="10">
        <nextscreen name="Verificar12_004_${par.numeroCarro}" />
        <nextscreen name="Verificar01_41${par.numeroCarro}" />
        <nextscreen name="ContinuarCarro_${par.numeroCarro}" />
    </nextscreens>
</screen>
<!-- Screen de verificación 12/004 -->
<screen name="Verificar12_004_${par.numeroCarro}" entryscreen="false" exitscreen="false" transient="false">
    <description><cursor row="12" col="4" optional="false" invertmatch="false" /></description>
    <actions><input value="[pf3]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" /></actions>
    <nextscreens timeout="10"><nextscreen name="ContinuarCarro_${par.numeroCarro}" /></nextscreens>
</screen>
<!-- Screen de verificación 01/41 -->
<screen name="Verificar01_41${par.numeroCarro}" entryscreen="false" exitscreen="false" transient="false">
    <description><cursor row="1" col="41" optional="false" invertmatch="false" /></description>
    <actions><input value="[enter]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" /></actions>
    <nextscreens timeout="10"><nextscreen name="ContinuarCarro_${par.numeroCarro}" /></nextscreens>
</screen>
<!-- Continuar con proceso normal -->
<screen name="ContinuarCarro_${par.numeroCarro}" entryscreen="false" exitscreen="false" transient="false">
    <description><oia status="NOTINHIBITED" optional="false" invertmatch="false" /></description>
    <actions>
        ${generarAcciones(val11, val12, dobleOperador)}
    </actions>
    <nextscreens timeout="1000">
        ${siguienteBloque ? `<nextscreen name="${siguienteBloque}" />` : ''}
    </nextscreens>
</screen>
`;
    });

    macro += `</HAScript>`;
    resultado.value = macro;
}

function generarAcciones(val11, val12, dobleOperador) {
    if (!dobleOperador) {
        // Macro original para un operador
        return `<input value="[reset]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />      
        <input value="[pagedn][pagedn][pagedn][pagedn]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="13" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="36800" row="13" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[pagedn][pagedn][pagedn]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="11" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="${val11}" row="11" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[pagedn][pagedn]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="13" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="${val12}" row="13" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[pf5]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />`;
    } else {
        // Macro para doble operador
        return `<input value="[reset]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />      
        <input value="[pagedn][pagedn][pagedn][pagedn]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="13" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="36800" row="13" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />     
        <input value="[pagedn][pagedn][pagedn]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="11" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="" row="11" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="${val11}" row="11" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="12" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="" row="12" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="${val11}" row="12" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[pagedn][pagedn]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="13" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="${val12}" row="13" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="14" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="${val12}" row="14" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[pf5]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />`;
    }
}

function copiarResultado() {
    const resultado = document.getElementById('resultado');
    resultado.select();
    document.execCommand('copy');
    alert("HAScript copiado al portapapeles.");
}

function limpiarCampos() {
    document.getElementById('listado').value = "";
    document.getElementById('resultado').value = "";
    document.getElementById('dobleOperador').checked = false;
}
</script>
</body>
</html>
