<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generador HAScript Pagos</title>
<style>
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(120deg, #f3f4f6 0%, #e0e7ef 100%);
  min-height: 100vh;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
}

.container {
  background: #fff;
  border-radius: 50px;
  box-shadow: 0 4px 24px #1e293b11;
  padding: 2.2rem 2.5rem 2.2rem 2rem;
  margin: 2.5rem 0;
  max-width: 1920px;
  width: 100%;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 1.2rem;
  box-sizing: border-box;
}

h1 {
  font-size: 1.5rem;
  font-weight: 700;
  color: #1e293b;
  margin-bottom: 0.5rem;
}

h2, h3 {
  color: #1e293b;
  margin-top: 1.2rem;
  margin-bottom: 0.7rem;
  font-size: 1.08rem;
  font-weight: 500;
  text-align: left;
}

p {
  color: #374151;
  font-size: 1.08rem;
  margin-bottom: 0.5rem;
  text-align: left;
}

textarea, input, select {
  width: 100%;
  margin: 0.5rem 0;
  padding: 0.8rem;
  font-size: 1rem;
  font-family: 'Segoe UI Mono', 'Consolas', monospace;
  border-radius: 8px;
  border: 1px solid #cbd5e1;
  background: #f8fafc;
  transition: border 0.2s;
  box-sizing: border-box;
}

textarea:focus, input:focus, select:focus {
  border: 1.5px solid #2563eb;
  outline: none;
  background: #fff;
}

.button-row {
  display: flex;
  gap: 0.7rem;
  margin-bottom: 0.2rem;
  flex-wrap: wrap;
}

button, .button {
  padding: 0.7rem 1.5rem;
  border-radius: 8px;
  border: none;
  background: linear-gradient(90deg, #2563eb 60%, #1e40af 100%);
  color: #fff;
  font-size: 1.08rem;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 2px 8px #2563eb22;
  transition: background 0.2s, color 0.2s, box-shadow 0.2s;
}

button:hover, .button:hover {
  background: linear-gradient(90deg, #1e40af 60%, #2563eb 100%);
  color: #e0e7ef;
  box-shadow: 0 4px 16px #2563eb33;
}

.preview-label {
  font-size: 1.08rem;
  color: #334155;
  font-weight: 500;
  margin-bottom: 0.2rem;
}

pre, #resultado {
  background: #f4f7fa;
  border-radius: 8px;
  padding: 1rem;
  font-family: 'Segoe UI Mono', 'Consolas', monospace;
  font-size: 0.98rem;
  color: #1e293b;
  min-height: 80px;
  box-shadow: 0 1px 4px #1e293b0a;
  white-space: pre-wrap;
  overflow-x: auto;
  border: none;
  margin-bottom: 0.5rem;
  resize: vertical;
}

.checkbox-container {
  display: flex;
  align-items: center;
  gap: 0.8rem;
  margin: 0.8rem 0;
  padding: 1rem;
  background: linear-gradient(135deg, #f0f9ff 0%, #f0f4ff 100%);
  border-left: 4px solid #2563eb;
  border-radius: 8px;
}

.checkbox-container input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
  accent-color: #2563eb;
}

.checkbox-container label {
  cursor: pointer;
  font-weight: 500;
  color: #1e293b;
  margin: 0;
  font-size: 1.08rem;
}

::-webkit-scrollbar {
  width: 8px;
  background: #e5e7eb;
}

::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 6px;
}

::selection {
  background: #2563eb33;
}

@media (max-width: 900px) {
  .container {
    max-width: 98vw;
    padding: 1.2rem 0.7rem;
    margin: 1.2rem 0.2rem;
  }
}

@media (max-width: 600px) {
  .container {
    max-width: 100vw;
    padding: 0.5rem 0.1rem;
    margin: 0.5rem 0;
    border-radius: 0;
    box-shadow: none;
  }
  
  h1 { 
    font-size: 1rem; 
  }
  
  button, .button { 
    font-size: 0.95rem; 
    padding: 0.5rem 0.7rem; 
  }
  
  pre, #resultado { 
    font-size: 0.92rem; 
  }
  
  .button-row {
    gap: 0.5rem;
  }
}
</style>
</head>
<body>
<div class="container">
    <h1>Generador de HAScript Pagos</h1>

    <p class="preview-label">Pega el listado (formato: Carro TAB Tipo 6/7/8):</p>
    <textarea id="listado" placeholder="220324	7&#10;240092	6"></textarea>

    <div class="checkbox-container">
        <input type="checkbox" id="dobleOperador" name="dobleOperador">
        <label for="dobleOperador">¿Doble Operador?</label>
    </div>

    <div class="button-row">
        <button onclick="generarHAScript()">Generar</button>
        <button onclick="copiarResultado()">Copiar</button>
        <button onclick="limpiarCampos()">Limpiar</button>
    </div>

    <h3>Resultado:</h3>
    <textarea id="resultado" readonly></textarea>
</div>

<script>
function generarHAScript() {
    const texto = document.getElementById('listado').value.trim();
    const resultado = document.getElementById('resultado');
    const dobleOperador = document.getElementById('dobleOperador').checked;
    
    if (!texto) { alert("Por favor ingresa el listado."); return; }

    const lineas = texto.split('\n');
    const pares = [];

    for (const linea of lineas) {
        const match = linea.match(/^(\d+)\s+(\d+)$/);
        if (match) { pares.push({ numeroCarro: match[1], tipo: match[2] }); }
    }

    if (pares.length === 0) { resultado.value = "No se encontraron pares válidos."; return; }

let macro = `<HAScript name="despacho" description="Flujo completo" timeout="20000" pausetime="300" promptall="true" blockinput="true" author="burra" creationdate="Oct 02, 2025 12:00:00 PM" supressclearevents="false" usevars="false" ignorepauseforenhancedtn="true" delayifnotenhancedtn="0" ignorepausetimeforenhancedtn="true" continueontimeout="false">\n`;

pares.forEach((par, index) => {
    let val11 = "", val12 = "";
    if (par.tipo === "6") { val11 = "3150"; val12 = "1800"; }
    if (par.tipo === "7") { val11 = "3675"; val12 = "2100"; }
    if (par.tipo === "8") { val11 = "4200"; val12 = "2400"; }

    // Encadenar al inicio del siguiente carro para mantener el patrón completo
    const siguienteBloque = index < pares.length - 1
        ? `InicioCarro_${pares[index+1].numeroCarro}_${pares[index+1].tipo}`
        : "";

    macro += `
<!-- ====== Bloque ${index+1} ====== -->

<!-- ====== BLOQUE INICIAL (SEPARADO) ====== -->
<screen name="InicioCarro_${par.numeroCarro}_${par.tipo}" entryscreen="${index===0?'true':'false'}" exitscreen="false" transient="false">
    <description>
        <oia status="NOTINHIBITED" optional="false" invertmatch="false" />
    </description>
    <actions>
        ${index===0?'':'<input value="[pf3]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />'}
        <input value="${par.numeroCarro}" row="1" col="8" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[enter]" row="1" col="8" movecursor="true" xlatehostkeys="true" encrypted="false" />
    </actions>
    <nextscreens timeout="10">
        <!-- Después del ENTER, verificar pantalla 01 -->
        <nextscreen name="Verificar01_${par.numeroCarro}" />
        <!-- Fallback por si el host salta directo -->
        <nextscreen name="Carro_${par.numeroCarro}_${par.tipo}" />
    </nextscreens>
</screen>

<!-- ====== VERIFICACIÓN INMEDIATA DESPUÉS DEL ENTER ====== -->
<screen name="Verificar01_${par.numeroCarro}" entryscreen="false" exitscreen="false" transient="false">
    <description>
        <cursor row="5" col="2" optional="false" invertmatch="false" />
    </description>
    <actions>
        <input value="[pf3]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
    </actions>
    <nextscreens timeout="10">
        <nextscreen name="Carro_${par.numeroCarro}_${par.tipo}" />
    </nextscreens>
</screen>

<!-- ====== PROCESO DEL CARRO (NOGASO + VERIFICACIONES + CONTINUACIÓN) ====== -->
<screen name="Carro_${par.numeroCarro}_${par.tipo}" entryscreen="false" exitscreen="false" transient="false">
    <description>
        <oia status="NOTINHIBITED" optional="false" invertmatch="false" />
    </description>
    <actions>
        <input value="NOGASO" row="1" col="42" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="X" row="1" col="68" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[enter]" row="1" col="68" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[enter]" row="1" col="68" movecursor="true" xlatehostkeys="true" encrypted="false" />
    </actions>
    <nextscreens timeout="10">
        <nextscreen name="Verificar12_004_${par.numeroCarro}" />
        <nextscreen name="Verificar01_41${par.numeroCarro}" />
        <nextscreen name="ContinuarCarro_${par.numeroCarro}" />
    </nextscreens>
</screen>

<!-- ====== VERIFICACIÓN 12/004 ====== -->
<screen name="Verificar12_004_${par.numeroCarro}" entryscreen="false" exitscreen="false" transient="false">
    <description>
        <cursor row="12" col="4" optional="false" invertmatch="false" />
    </description>
    <actions>
        <input value="[pf3]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
    </actions>
    <nextscreens timeout="10">
        <nextscreen name="Verificar12_0004_${par.numeroCarro}" />
        <nextscreen name="ContinuarCarro_${par.numeroCarro}" />
    </nextscreens>
</screen>

<!-- ====== VERIFICACIÓN 12/00004 ====== -->
<screen name="Verificar12_0004_${par.numeroCarro}" entryscreen="false" exitscreen="false" transient="false">
    <description>
        <cursor row="12" col="4" optional="false" invertmatch="false" />
    </description>
    <actions>
        <input value="[pf3]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
    </actions>
    <nextscreens timeout="10">
        <nextscreen name="ContinuarCarro_${par.numeroCarro}" />
    </nextscreens>
</screen>

<!-- ====== VERIFICACIÓN 01/41 ====== -->
<screen name="Verificar01_41${par.numeroCarro}" entryscreen="false" exitscreen="false" transient="false">
    <description>
        <cursor row="1" col="41" optional="false" invertmatch="false" />
    </description>
    <actions>
        <input value="[enter]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
    </actions>
    <nextscreens timeout="10">
        <nextscreen name="ContinuarCarro_${par.numeroCarro}" />
    </nextscreens>
</screen>

<!-- ====== CONTINUACIÓN NORMAL DEL PROCESO ====== -->
<screen name="ContinuarCarro_${par.numeroCarro}" entryscreen="false" exitscreen="false" transient="false">
    <description>
        <oia status="NOTINHIBITED" optional="false" invertmatch="false" />
    </description>
    <actions>
        ${generarAcciones(val11, val12, dobleOperador)}
    </actions>
    <nextscreens timeout="1000">
        ${siguienteBloque ? `<nextscreen name="${siguienteBloque}" />` : ''}
    </nextscreens>
</screen>
`;
});

macro += `</HAScript>`;
resultado.value = macro;
}
function generarAcciones(val11, val12, dobleOperador) {
    if (!dobleOperador) {
        // Macro original para un operador
        return `<input value="[reset]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />      
        <input value="[pagedn][pagedn][pagedn][pagedn]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="13" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="36800" row="13" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[pagedn][pagedn][pagedn]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="11" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="${val11}" row="11" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[pagedn][pagedn]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="13" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="${val12}" row="13" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[pf5]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />`;
    } else {
        // Macro para doble operador
        return `<input value="[reset]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />      
        <input value="[pagedn][pagedn][pagedn][pagedn]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="13" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="36800" row="13" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[pagedn][pagedn][pagedn]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="11" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="${val11}" row="11" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="12" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="${val11}" row="12" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[pagedn][pagedn]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="13" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="${val12}" row="13" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="1" row="14" col="21" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="${val12}" row="14" col="28" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[field+]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />
        <input value="[pf5]" row="0" col="0" movecursor="true" xlatehostkeys="true" encrypted="false" />`;
    }
}

function copiarResultado() {
    const resultado = document.getElementById('resultado');
    resultado.select();
    document.execCommand('copy');
    alert("HAScript copiado al portapapeles.");
}

function limpiarCampos() {
    document.getElementById('listado').value = "";
    document.getElementById('resultado').value = "";
    document.getElementById('dobleOperador').checked = false;
}
</script>
</body>
</html>
